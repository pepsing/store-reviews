(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{392:function(e,t,a){},637:function(e,t,a){},638:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a.n(s),r=a(39),n=a.n(r),i=(a(392),a(654)),l=a(648),o=a(647),j=a(381),d=a(642),b=a(643),p=a(90),h=a(650),O=a(655),x=a(644),u=a(377),m=a(651),g=a(652),y=a(653),f=a(158),v=a(383),S=a(384),w=a(656),_=a(657),C=a(658),I=a(645),k=a(649),A=a(646),F=a(373),T=a(374),P=a(110),$=a(135),D=a(372),z=a(96),E=a.n(z),q=a(9);const{Paragraph:K}=l.a,L=10,V=()=>{const[e,t]=Object(s.useState)([]),[a,c]=Object(s.useState)(null),[r,n]=Object(s.useState)([]),[i,l]=Object(s.useState)(!1),[z,V]=Object(s.useState)(!1),[B]=o.a.useForm(),[J,M]=Object(s.useState)(!1),[G,H]=Object(s.useState)(null),[N,X]=Object(s.useState)({ios:1,android:1}),[Y,Q]=Object(s.useState)(!1),[R,U]=Object(s.useState)(localStorage.getItem("authCode")||""),[W,Z]=Object(s.useState)((()=>Promise.resolve())),[ee,te]=Object(s.useState)({});Object(s.useEffect)((()=>{(async()=>{try{const e=await fetch("/config/countries.json"),t=await e.json();te(t)}catch(e){console.error("\u52a0\u8f7d\u56fd\u5bb6\u914d\u7f6e\u5931\u8d25:",e),j.b.error("\u52a0\u8f7d\u56fd\u5bb6\u914d\u7f6e\u5931\u8d25")}})()}),[]),Object(s.useEffect)((()=>{ae()}),[]);const ae=async()=>{try{const e=await E.a.get("/api/apps");t(e.data)}catch(e){j.b.error("\u83b7\u53d6\u5e94\u7528\u5217\u8868\u5931\u8d25")}},se=async e=>{l(!0);try{const t=await E.a.get(`/api/apps/${e}/reviews`);n(t.data)}catch(t){j.b.error("\u83b7\u53d6\u8bc4\u8bba\u5931\u8d25")}finally{l(!1)}},ce=async e=>{if(!R)return Z((()=>e)),void Q(!0);try{await e()}catch(a){var t;if(401!==(null===(t=a.response)||void 0===t?void 0:t.status))throw a;j.b.error("\u6388\u6743\u7801\u65e0\u6548"),U(""),localStorage.removeItem("authCode"),Z((()=>e)),Q(!0)}};Object(s.useEffect)((()=>{const e=E.a.interceptors.request.use((e=>{const t={...e};return t.headers=t.headers||{},R&&(t.headers["X-Auth-Code"]=R),t}));return()=>{E.a.interceptors.request.eject(e)}}),[R]);const re=()=>{const e={};r.forEach((t=>{const a=new Date(t.created_at),s=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;e[s]||(e[s]={ios:{sum:0,count:0},android:{sum:0,count:0}}),e[s][t.platform].sum+=t.rating,e[s][t.platform].count+=1}));const t=[];return Object.entries(e).sort(((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)})).forEach((e=>{let[a,s]=e;s.ios.count>0&&t.push({date:a,platform:"iOS",average_rating:s.ios.sum/s.ios.count}),s.android.count>0&&t.push({date:a,platform:"Android",average_rating:s.android.sum/s.android.count})})),t},ne=r.filter((e=>"ios"===e.platform)),ie=r.filter((e=>"android"===e.platform)),le=e=>{if(0===e.length)return 0;const t=e.reduce(((e,t)=>e+t.rating),0);return Number((t/e.length).toFixed(1))},oe=le(ne),je=le(ie);return Object(q.jsxs)("div",{style:{padding:"24px"},children:[Object(q.jsxs)(d.a,{gutter:[16,16],justify:"space-between",align:"middle",children:[Object(q.jsx)(b.a,{children:Object(q.jsx)("h2",{children:"\u5e94\u7528\u5217\u8868"})}),Object(q.jsx)(b.a,{children:Object(q.jsx)(p.a,{type:"primary",icon:Object(q.jsx)(v.a,{}),onClick:()=>V(!0),children:"\u6dfb\u52a0\u5e94\u7528"})})]}),Object(q.jsx)(d.a,{gutter:[16,16],style:{marginTop:"16px"},children:e.map((e=>Object(q.jsx)(b.a,{xs:24,sm:12,md:8,lg:6,children:Object(q.jsxs)(h.a,{title:e.name,extra:Object(q.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[Object(q.jsx)(p.a,{type:"text",icon:Object(q.jsx)(S.a,{}),onClick:()=>{H(e),B.setFieldsValue(e)}}),Object(q.jsx)(O.a,{title:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5e94\u7528\u5417\uff1f",onConfirm:()=>(async e=>{await ce((async()=>{await E.a.delete(`/api/apps/${e}`),j.b.success("\u5220\u9664\u5e94\u7528\u6210\u529f"),(null===a||void 0===a?void 0:a.id)===e&&c(null),ae()}))})(e.id),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:Object(q.jsx)(p.a,{type:"text",danger:!0,icon:Object(q.jsx)(w.a,{})})})]}),hoverable:!0,onClick:()=>{c(e),se(e.id)},children:[Object(q.jsxs)("p",{children:["\u5e73\u53f0: ",e.platform]}),e.app_store_id&&Object(q.jsxs)("p",{children:["App Store ID: ",e.app_store_id]}),e.play_store_id&&Object(q.jsxs)("p",{children:["Play Store ID: ",e.play_store_id]})]})},e.id)))}),a&&Object(q.jsxs)(h.a,{style:{marginTop:"24px"},children:[Object(q.jsxs)(d.a,{justify:"space-between",align:"middle",children:[Object(q.jsx)(b.a,{children:Object(q.jsxs)("h3",{children:[a.name," \u8bc4\u5206\u8d8b\u52bf"]})}),Object(q.jsx)(b.a,{children:Object(q.jsxs)(p.a.Group,{children:[Object(q.jsx)(p.a,{type:"primary",icon:Object(q.jsx)(_.a,{spin:J}),onClick:()=>(async e=>{M(!0);try{await E.a.post(`/api/apps/${e}/refresh`),j.b.success("\u8bc4\u5206\u66f4\u65b0\u6210\u529f"),await se(e)}catch(t){j.b.error("\u8bc4\u5206\u66f4\u65b0\u5931\u8d25")}finally{M(!1)}})(a.id),loading:J,children:"\u66f4\u65b0\u8bc4\u5206"}),Object(q.jsx)(p.a,{type:"primary",icon:Object(q.jsx)(C.a,{}),onClick:()=>(async e=>{try{j.b.loading("\u6b63\u5728\u51c6\u5907\u5bfc\u51fa\u6587\u4ef6...",1),window.open(`/api/apps/${e}/export`,"_blank"),j.b.success("\u8bc4\u8bba\u5bfc\u51fa\u6210\u529f")}catch(t){j.b.error("\u8bc4\u8bba\u5bfc\u51fa\u5931\u8d25")}})(a.id),children:"\u5bfc\u51fa\u8bc4\u8bba"})]})})]}),i?Object(q.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:Object(q.jsx)(x.a,{})}):Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)(I.a,{width:"100%",height:400,children:Object(q.jsxs)(k.a,{data:re(),children:[Object(q.jsx)(A.a,{strokeDasharray:"3 3"}),Object(q.jsx)(F.a,{dataKey:"date"}),Object(q.jsx)(T.a,{domain:[0,5]}),Object(q.jsx)(P.a,{formatter:e=>e.toFixed(2)}),Object(q.jsx)($.a,{}),Object(q.jsx)(D.a,{type:"monotone",dataKey:"average_rating",name:"iOS",stroke:"#8884d8",data:re().filter((e=>"iOS"===e.platform))}),Object(q.jsx)(D.a,{type:"monotone",dataKey:"average_rating",name:"Android",stroke:"#82ca9d",data:re().filter((e=>"Android"===e.platform))})]})}),Object(q.jsxs)("div",{style:{marginTop:"24px"},children:[Object(q.jsx)("h3",{children:"\u6700\u65b0\u8bc4\u8bba"}),Object(q.jsxs)(u.a,{defaultActiveKey:"ios",children:[Object(q.jsxs)(u.a.TabPane,{tab:`iOS \u8bc4\u8bba (${oe}\u2b50)`,children:[Object(q.jsxs)(d.a,{gutter:[16,16],children:[ne.slice((N.ios-1)*L,N.ios*L).map((e=>Object(q.jsx)(b.a,{span:24,children:Object(q.jsxs)(h.a,{size:"small",children:[Object(q.jsxs)("p",{children:["\u8bc4\u5206: ","\u2b50".repeat(e.rating)]}),Object(q.jsxs)("p",{children:["\u5185\u5bb9:",Object(q.jsx)(K,{ellipsis:{rows:2,expandable:!0,symbol:"\u5c55\u5f00"},children:e.content})]}),Object(q.jsxs)("p",{children:["\u4f5c\u8005: ",e.author]}),Object(q.jsxs)("p",{children:["\u65f6\u95f4: ",new Date(e.created_at).toLocaleString()]})]})},e.id))),0===ne.length&&Object(q.jsx)(b.a,{span:24,children:Object(q.jsx)(h.a,{size:"small",children:Object(q.jsx)("p",{children:"\u6682\u65e0 iOS \u8bc4\u8bba"})})})]}),ne.length>0&&Object(q.jsx)("div",{style:{textAlign:"right",marginTop:"16px"},children:Object(q.jsx)(m.a,{current:N.ios,onChange:e=>X((t=>({...t,ios:e}))),total:ne.length,pageSize:L,showTotal:e=>`\u5171 ${e} \u6761\u8bc4\u8bba`})})]},"ios"),Object(q.jsxs)(u.a.TabPane,{tab:`Android \u8bc4\u8bba (${je}\u2b50)`,children:[Object(q.jsxs)(d.a,{gutter:[16,16],children:[ie.slice((N.android-1)*L,N.android*L).map((e=>Object(q.jsx)(b.a,{span:24,children:Object(q.jsxs)(h.a,{size:"small",children:[Object(q.jsxs)("p",{children:["\u8bc4\u5206: ","\u2b50".repeat(e.rating)]}),Object(q.jsxs)("p",{children:["\u5185\u5bb9:",Object(q.jsx)(K,{ellipsis:{rows:2,expandable:!0,symbol:"\u5c55\u5f00"},children:e.content})]}),Object(q.jsxs)("p",{children:["\u4f5c\u8005: ",e.author]}),Object(q.jsxs)("p",{children:["\u65f6\u95f4: ",new Date(e.created_at).toLocaleString()]})]})},e.id))),0===ie.length&&Object(q.jsx)(b.a,{span:24,children:Object(q.jsx)(h.a,{size:"small",children:Object(q.jsx)("p",{children:"\u6682\u65e0 Android \u8bc4\u8bba"})})})]}),ie.length>0&&Object(q.jsx)("div",{style:{textAlign:"right",marginTop:"16px"},children:Object(q.jsx)(m.a,{current:N.android,onChange:e=>X((t=>({...t,android:e}))),total:ie.length,pageSize:L,showTotal:e=>`\u5171 ${e} \u6761\u8bc4\u8bba`})})]},"android")]})]})]})]}),Object(q.jsx)(g.a,{title:G?"\u4fee\u6539\u5e94\u7528":"\u6dfb\u52a0\u5e94\u7528",visible:z||!!G,onCancel:()=>{V(!1),H(null),B.resetFields()},footer:null,children:Object(q.jsxs)(o.a,{form:B,onFinish:G?async e=>{await ce((async()=>{await E.a.put(`/api/apps/${null===G||void 0===G?void 0:G.id}`,e),j.b.success("\u4fee\u6539\u5e94\u7528\u6210\u529f"),H(null),B.resetFields(),ae()}))}:async e=>{await ce((async()=>{await E.a.post("/api/apps",e),j.b.success("\u6dfb\u52a0\u5e94\u7528\u6210\u529f"),V(!1),B.resetFields(),ae()}))},layout:"vertical",children:[Object(q.jsx)(o.a.Item,{name:"name",label:"\u5e94\u7528\u540d\u79f0",rules:[{required:!0}],children:Object(q.jsx)(y.a,{})}),Object(q.jsx)(o.a.Item,{name:"platform",label:"\u5e73\u53f0",rules:[{required:!0}],children:Object(q.jsxs)(f.a,{children:[Object(q.jsx)(f.a.Option,{value:"ios",children:"iOS"}),Object(q.jsx)(f.a.Option,{value:"android",children:"Android"}),Object(q.jsx)(f.a.Option,{value:"both",children:"\u53cc\u5e73\u53f0"})]})}),Object(q.jsx)(o.a.Item,{name:"app_store_country",label:"App Store \u5730\u533a",initialValue:"cn",children:Object(q.jsx)(f.a,{children:Object.entries(ee).map((e=>{let[t,a]=e;return Object(q.jsx)(f.a.Option,{value:t,children:a},t)}))})}),Object(q.jsx)(o.a.Item,{name:"play_store_country",label:"Play Store \u5730\u533a",initialValue:"cn",children:Object(q.jsx)(f.a,{children:Object.entries(ee).map((e=>{let[t,a]=e;return Object(q.jsx)(f.a.Option,{value:t,children:a},t)}))})}),Object(q.jsx)(o.a.Item,{name:"app_store_id",label:"App Store ID",rules:[{pattern:/^\d+$/,message:"App Store ID \u5fc5\u987b\u662f\u6570\u5b57"}],children:Object(q.jsx)(y.a,{placeholder:"\u4f8b\u5982\uff1a414478124"})}),Object(q.jsx)(o.a.Item,{name:"play_store_id",label:"Play Store ID",children:Object(q.jsx)(y.a,{})}),Object(q.jsx)(o.a.Item,{children:Object(q.jsx)(p.a,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})}),Object(q.jsx)(g.a,{title:"\u8bf7\u8f93\u5165\u6388\u6743\u7801",visible:Y,onOk:async()=>{try{if(!R)return void j.b.error("\u6388\u6743\u7801\u4e0d\u80fd\u4e3a\u7a7a");await W(),localStorage.setItem("authCode",R),Q(!1)}catch(e){j.b.error("\u64cd\u4f5c\u5931\u8d25"),localStorage.removeItem("authCode")}},onCancel:()=>{Q(!1),Z((()=>Promise.resolve())),U("")},children:Object(q.jsx)(y.a.Password,{value:R,onChange:e=>U(e.target.value),placeholder:"\u8bf7\u8f93\u5165\u6388\u6743\u7801"})})]})};a(637);const{Header:B,Content:J}=i.a;var M=()=>Object(q.jsxs)(i.a,{children:[Object(q.jsx)(B,{style:{background:"#fff",padding:"0 24px"},children:Object(q.jsx)("h1",{children:"\u5e94\u7528\u8bc4\u5206\u8ffd\u8e2a\u7cfb\u7edf"})}),Object(q.jsx)(J,{children:Object(q.jsx)(V,{})})]});var G=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,659)).then((t=>{let{getCLS:a,getFID:s,getFCP:c,getLCP:r,getTTFB:n}=t;a(e),s(e),c(e),r(e),n(e)}))};n.a.render(Object(q.jsx)(c.a.StrictMode,{children:Object(q.jsx)(M,{})}),document.getElementById("root")),G()}},[[638,1,2]]]);
//# sourceMappingURL=main.0d38f8f1.chunk.js.map