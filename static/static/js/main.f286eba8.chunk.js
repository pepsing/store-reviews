(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{393:function(e,t,a){},638:function(e,t,a){},639:function(e,t,a){"use strict";a.r(t);var s=a(0),c=a.n(s),n=a(39),r=a.n(n),i=(a(393),a(655)),l=a(649),o=a(648),j=a(382),d=a(643),b=a(644),p=a(91),h=a(651),O=a(656),x=a(657),u=a(645),m=a(378),y=a(652),g=a(653),f=a(654),S=a(158),v=a(384),w=a(385),C=a(658),_=a(659),I=a(660),k=a(646),A=a(650),F=a(647),P=a(374),T=a(375),$=a(110),D=a(135),z=a(373),E=a(86),q=a.n(E),K=a(9);const{Paragraph:L}=l.a,N=10,V=()=>{const[e,t]=Object(s.useState)([]),[a,c]=Object(s.useState)(null),[n,r]=Object(s.useState)([]),[i,l]=Object(s.useState)(!1),[E,V]=Object(s.useState)(!1),[B]=o.a.useForm(),[J,M]=Object(s.useState)(!1),[H,X]=Object(s.useState)(null),[Y,G]=Object(s.useState)({ios:1,android:1}),[Q,R]=Object(s.useState)(!1),[U,W]=Object(s.useState)(localStorage.getItem("authCode")||""),[Z,ee]=Object(s.useState)((()=>Promise.resolve())),[te,ae]=Object(s.useState)({});Object(s.useEffect)((()=>{(async()=>{try{const e=await fetch("/config/countries.json"),t=await e.json();ae(t)}catch(e){console.error("\u52a0\u8f7d\u56fd\u5bb6\u914d\u7f6e\u5931\u8d25:",e),j.b.error("\u52a0\u8f7d\u56fd\u5bb6\u914d\u7f6e\u5931\u8d25")}})()}),[]),Object(s.useEffect)((()=>{se()}),[]);const se=async()=>{try{const e=await q.a.get("/api/apps");t(e.data)}catch(e){j.b.error("\u83b7\u53d6\u5e94\u7528\u5217\u8868\u5931\u8d25")}},ce=async e=>{l(!0);try{const t=await q.a.get(`/api/apps/${e}/reviews`);r(t.data)}catch(t){j.b.error("\u83b7\u53d6\u8bc4\u8bba\u5931\u8d25")}finally{l(!1)}},ne=async e=>{if(!U)return ee((()=>e)),void R(!0);try{await e()}catch(a){var t;if(401!==(null===(t=a.response)||void 0===t?void 0:t.status))throw a;j.b.error("\u6388\u6743\u7801\u65e0\u6548"),W(""),localStorage.removeItem("authCode"),ee((()=>e)),R(!0)}};Object(s.useEffect)((()=>{const e=q.a.interceptors.request.use((e=>{const t={...e};return t.headers=t.headers||{},U&&(t.headers["X-Auth-Code"]=U),t}));return()=>{q.a.interceptors.request.eject(e)}}),[U]);const re=async(e,t)=>{M(!0);try{await q.a.post(`/api/apps/${e}/refresh`,{platform:t}),j.b.success(("ios"===t?"App Store":"Play Store")+" \u8bc4\u5206\u66f4\u65b0\u6210\u529f"),await ce(e)}catch(a){j.b.error(("ios"===t?"App Store":"Play Store")+" \u8bc4\u5206\u66f4\u65b0\u5931\u8d25")}finally{M(!1)}},ie=n.filter((e=>"ios"===e.platform)),le=n.filter((e=>"android"===e.platform)),oe=e=>{if(0===e.length)return 0;const t=e.reduce(((e,t)=>e+t.rating),0);return Number((t/e.length).toFixed(1))},je=oe(ie),de=oe(le);return Object(K.jsxs)("div",{style:{padding:"24px"},children:[Object(K.jsxs)(d.a,{gutter:[16,16],justify:"space-between",align:"middle",children:[Object(K.jsx)(b.a,{children:Object(K.jsx)("h2",{children:"\u5e94\u7528\u5217\u8868"})}),Object(K.jsx)(b.a,{children:Object(K.jsx)(p.a,{type:"primary",icon:Object(K.jsx)(v.a,{}),onClick:()=>V(!0),children:"\u6dfb\u52a0\u5e94\u7528"})})]}),Object(K.jsx)(d.a,{gutter:[16,16],style:{marginTop:"16px"},children:e.map((e=>Object(K.jsx)(b.a,{xs:24,sm:12,md:8,lg:6,children:Object(K.jsxs)(h.a,{title:e.name,extra:Object(K.jsxs)("div",{onClick:e=>e.stopPropagation(),children:[Object(K.jsx)(p.a,{type:"text",icon:Object(K.jsx)(w.a,{}),onClick:()=>{X(e),B.setFieldsValue(e)}}),Object(K.jsx)(O.a,{title:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e2a\u5e94\u7528\u5417\uff1f",onConfirm:()=>(async e=>{await ne((async()=>{await q.a.delete(`/api/apps/${e}`),j.b.success("\u5220\u9664\u5e94\u7528\u6210\u529f"),(null===a||void 0===a?void 0:a.id)===e&&c(null),se()}))})(e.id),okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:Object(K.jsx)(p.a,{type:"text",danger:!0,icon:Object(K.jsx)(C.a,{})})})]}),hoverable:!0,onClick:()=>{c(e),ce(e.id)},children:[Object(K.jsxs)("p",{children:["\u5e73\u53f0: ",e.platform]}),e.app_store_id&&Object(K.jsxs)("p",{children:["App Store ID: ",e.app_store_id]}),e.play_store_id&&Object(K.jsxs)("p",{children:["Play Store ID: ",e.play_store_id]})]})},e.id)))}),a&&Object(K.jsxs)(h.a,{style:{marginTop:"24px"},children:[Object(K.jsxs)(d.a,{justify:"space-between",align:"middle",children:[Object(K.jsx)(b.a,{children:Object(K.jsxs)("h3",{children:[a.name," \u8bc4\u5206\u8d8b\u52bf"]})}),Object(K.jsx)(b.a,{children:Object(K.jsxs)(x.b,{size:"middle",children:["android"!==a.platform&&Object(K.jsx)(p.a,{type:"primary",icon:Object(K.jsx)(_.a,{spin:J}),onClick:()=>re(a.id,"ios"),loading:J,children:"\u66f4\u65b0 App Store"}),"ios"!==a.platform&&Object(K.jsx)(p.a,{type:"primary",icon:Object(K.jsx)(_.a,{spin:J}),onClick:()=>re(a.id,"android"),loading:J,children:"\u66f4\u65b0 Play Store"}),Object(K.jsx)(p.a,{type:"default",icon:Object(K.jsx)(_.a,{spin:J}),onClick:()=>(async e=>{M(!0);try{await q.a.post(`/api/apps/${e}/refresh/latest`,{limit:100}),j.b.success("\u6700\u65b0\u8bc4\u8bba\u66f4\u65b0\u6210\u529f"),await ce(e)}catch(t){j.b.error("\u6700\u65b0\u8bc4\u8bba\u66f4\u65b0\u5931\u8d25")}finally{M(!1)}})(a.id),loading:J,children:"\u5237\u65b0\u6700\u65b0\u8bc4\u8bba"}),Object(K.jsx)(p.a,{type:"default",icon:Object(K.jsx)(I.a,{}),onClick:()=>(async e=>{try{j.b.loading("\u6b63\u5728\u51c6\u5907\u5bfc\u51fa\u6587\u4ef6...",1),window.open(`/api/apps/${e}/export`,"_blank"),j.b.success("\u8bc4\u8bba\u5bfc\u51fa\u6210\u529f")}catch(t){j.b.error("\u8bc4\u8bba\u5bfc\u51fa\u5931\u8d25")}})(a.id),children:"\u5bfc\u51fa\u8bc4\u8bba"})]})})]}),i?Object(K.jsx)("div",{style:{textAlign:"center",padding:"40px"},children:Object(K.jsx)(u.a,{})}):Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(k.a,{width:"100%",height:400,children:Object(K.jsxs)(A.a,{data:(()=>{const e={};return n.forEach((t=>{const a=new Date(t.created_at),s=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;e[s]||(e[s]={ios:{sum:0,count:0},android:{sum:0,count:0}}),e[s][t.platform].sum+=t.rating,e[s][t.platform].count+=1})),Object.entries(e).sort(((e,t)=>{let[a]=e,[s]=t;return a.localeCompare(s)})).map((e=>{let[t,a]=e;return{date:t,ios:a.ios.count>0?a.ios.sum/a.ios.count:null,android:a.android.count>0?a.android.sum/a.android.count:null}}))})(),children:[Object(K.jsx)(F.a,{strokeDasharray:"3 3"}),Object(K.jsx)(P.a,{dataKey:"date"}),Object(K.jsx)(T.a,{domain:[0,5]}),Object(K.jsx)($.a,{formatter:e=>e?e.toFixed(2):"\u6682\u65e0\u6570\u636e",labelFormatter:e=>`${e} \u6708\u5ea6\u5747\u5206`}),Object(K.jsx)(D.a,{}),Object(K.jsx)(z.a,{type:"monotone",dataKey:"ios",name:"iOS",stroke:"#8884d8",connectNulls:!0}),Object(K.jsx)(z.a,{type:"monotone",dataKey:"android",name:"Android",stroke:"#82ca9d",connectNulls:!0})]})}),Object(K.jsxs)("div",{style:{marginTop:"24px"},children:[Object(K.jsx)("h3",{children:"\u6700\u65b0\u8bc4\u8bba"}),Object(K.jsxs)(m.a,{defaultActiveKey:"ios",children:[Object(K.jsxs)(m.a.TabPane,{tab:`iOS \u8bc4\u8bba (${je}\u2b50)`,children:[Object(K.jsxs)(d.a,{gutter:[16,16],children:[ie.slice((Y.ios-1)*N,Y.ios*N).map((e=>Object(K.jsx)(b.a,{span:24,children:Object(K.jsxs)(h.a,{size:"small",children:[Object(K.jsxs)("p",{children:["\u8bc4\u5206: ","\u2b50".repeat(e.rating)]}),Object(K.jsxs)("p",{children:["\u5185\u5bb9:",Object(K.jsx)(L,{ellipsis:{rows:2,expandable:!0,symbol:"\u5c55\u5f00"},children:e.content})]}),Object(K.jsxs)("p",{children:["\u4f5c\u8005: ",e.author]}),Object(K.jsxs)("p",{children:["\u65f6\u95f4: ",new Date(e.created_at).toLocaleString()]})]})},e.id))),0===ie.length&&Object(K.jsx)(b.a,{span:24,children:Object(K.jsx)(h.a,{size:"small",children:Object(K.jsx)("p",{children:"\u6682\u65e0 iOS \u8bc4\u8bba"})})})]}),ie.length>0&&Object(K.jsx)("div",{style:{textAlign:"right",marginTop:"16px"},children:Object(K.jsx)(y.a,{current:Y.ios,onChange:e=>G((t=>({...t,ios:e}))),total:ie.length,pageSize:N,showTotal:e=>`\u5171 ${e} \u6761\u8bc4\u8bba`})})]},"ios"),Object(K.jsxs)(m.a.TabPane,{tab:`Android \u8bc4\u8bba (${de}\u2b50)`,children:[Object(K.jsxs)(d.a,{gutter:[16,16],children:[le.slice((Y.android-1)*N,Y.android*N).map((e=>Object(K.jsx)(b.a,{span:24,children:Object(K.jsxs)(h.a,{size:"small",children:[Object(K.jsxs)("p",{children:["\u8bc4\u5206: ","\u2b50".repeat(e.rating)]}),Object(K.jsxs)("p",{children:["\u5185\u5bb9:",Object(K.jsx)(L,{ellipsis:{rows:2,expandable:!0,symbol:"\u5c55\u5f00"},children:e.content})]}),Object(K.jsxs)("p",{children:["\u4f5c\u8005: ",e.author]}),Object(K.jsxs)("p",{children:["\u65f6\u95f4: ",new Date(e.created_at).toLocaleString()]})]})},e.id))),0===le.length&&Object(K.jsx)(b.a,{span:24,children:Object(K.jsx)(h.a,{size:"small",children:Object(K.jsx)("p",{children:"\u6682\u65e0 Android \u8bc4\u8bba"})})})]}),le.length>0&&Object(K.jsx)("div",{style:{textAlign:"right",marginTop:"16px"},children:Object(K.jsx)(y.a,{current:Y.android,onChange:e=>G((t=>({...t,android:e}))),total:le.length,pageSize:N,showTotal:e=>`\u5171 ${e} \u6761\u8bc4\u8bba`})})]},"android")]})]})]})]}),Object(K.jsx)(g.a,{title:H?"\u4fee\u6539\u5e94\u7528":"\u6dfb\u52a0\u5e94\u7528",visible:E||!!H,onCancel:()=>{V(!1),X(null),B.resetFields()},footer:null,children:Object(K.jsxs)(o.a,{form:B,onFinish:H?async e=>{await ne((async()=>{await q.a.put(`/api/apps/${null===H||void 0===H?void 0:H.id}`,e),j.b.success("\u4fee\u6539\u5e94\u7528\u6210\u529f"),X(null),B.resetFields(),se()}))}:async e=>{await ne((async()=>{await q.a.post("/api/apps",e),j.b.success("\u6dfb\u52a0\u5e94\u7528\u6210\u529f"),V(!1),B.resetFields(),se()}))},layout:"vertical",children:[Object(K.jsx)(o.a.Item,{name:"name",label:"\u5e94\u7528\u540d\u79f0",rules:[{required:!0}],children:Object(K.jsx)(f.a,{})}),Object(K.jsx)(o.a.Item,{name:"platform",label:"\u5e73\u53f0",rules:[{required:!0}],children:Object(K.jsxs)(S.a,{children:[Object(K.jsx)(S.a.Option,{value:"ios",children:"iOS"}),Object(K.jsx)(S.a.Option,{value:"android",children:"Android"}),Object(K.jsx)(S.a.Option,{value:"both",children:"\u53cc\u5e73\u53f0"})]})}),Object(K.jsx)(o.a.Item,{name:"app_store_country",label:"App Store \u5730\u533a",initialValue:"cn",children:Object(K.jsx)(S.a,{children:Object.entries(te).map((e=>{let[t,a]=e;return Object(K.jsx)(S.a.Option,{value:t,children:a},t)}))})}),Object(K.jsx)(o.a.Item,{name:"play_store_country",label:"Play Store \u5730\u533a",initialValue:"cn",children:Object(K.jsx)(S.a,{children:Object.entries(te).map((e=>{let[t,a]=e;return Object(K.jsx)(S.a.Option,{value:t,children:a},t)}))})}),Object(K.jsx)(o.a.Item,{name:"app_store_id",label:"App Store ID",rules:[{pattern:/^\d+$/,message:"App Store ID \u5fc5\u987b\u662f\u6570\u5b57"}],children:Object(K.jsx)(f.a,{placeholder:"\u4f8b\u5982\uff1a414478124"})}),Object(K.jsx)(o.a.Item,{name:"play_store_id",label:"Play Store ID",children:Object(K.jsx)(f.a,{})}),Object(K.jsx)(o.a.Item,{children:Object(K.jsx)(p.a,{type:"primary",htmlType:"submit",children:"\u63d0\u4ea4"})})]})}),Object(K.jsx)(g.a,{title:"\u8bf7\u8f93\u5165\u6388\u6743\u7801",visible:Q,onOk:async()=>{try{if(!U)return void j.b.error("\u6388\u6743\u7801\u4e0d\u80fd\u4e3a\u7a7a");await Z(),localStorage.setItem("authCode",U),R(!1)}catch(e){j.b.error("\u64cd\u4f5c\u5931\u8d25"),localStorage.removeItem("authCode")}},onCancel:()=>{R(!1),ee((()=>Promise.resolve())),W("")},children:Object(K.jsx)(f.a.Password,{value:U,onChange:e=>W(e.target.value),placeholder:"\u8bf7\u8f93\u5165\u6388\u6743\u7801"})})]})};a(638);const{Header:B,Content:J}=i.a;var M=()=>Object(K.jsxs)(i.a,{children:[Object(K.jsx)(B,{style:{background:"#fff",padding:"0 24px"},children:Object(K.jsx)("h1",{children:"\u5e94\u7528\u8bc4\u5206\u8ffd\u8e2a\u7cfb\u7edf"})}),Object(K.jsx)(J,{children:Object(K.jsx)(V,{})})]});var H=e=>{e&&e instanceof Function&&a.e(3).then(a.bind(null,661)).then((t=>{let{getCLS:a,getFID:s,getFCP:c,getLCP:n,getTTFB:r}=t;a(e),s(e),c(e),n(e),r(e)}))};r.a.render(Object(K.jsx)(c.a.StrictMode,{children:Object(K.jsx)(M,{})}),document.getElementById("root")),H()}},[[639,1,2]]]);
//# sourceMappingURL=main.f286eba8.chunk.js.map